<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<title>TODO: Name</title>
	<!--https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js-->
	<script src="phaser/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

	<script>

	var config = {
		type: Phaser.AUTO,
		width: 1280,	// = 40 x 32
		height: 800,	// = 25 x 32
		//pixelArt: true,
		scale: {
			mode: Phaser.Scale.FIT,
			autoCenter: Phaser.Scale.CENTER_BOTH,
		},
		physics: {
			default: "arcade",
			arcade: {
				gravity: { y: 300 },
				//debug: true,
			}
		},
		scene: {
			preload: preload,
			create: create,
			update: update
		}
	};

	var game = new Phaser.Game(config);
	var ground;
	var player;
	var coins;
	var cursors;
	var score;
	var scoreText;
	var jumpLimit;
	var jumps;

	function initCoins()
	{
		coins.children.iterate(function(child) {
			child.enableBody(true,
				Phaser.Math.Between(40, config.width - 40), Phaser.Math.Between(40, config.height - 40),
				true, true);
		});
	}

	function collectCoin(player, coin)
	{
		coin.disableBody(true, true);
		if (jumpLimit > 1)
		{
			jumpLimit -= 1;
		}
		
		score += 10;
		scoreText.setText("Score: " + score);
	}


	function preload()
	{
		this.load.image("sky", "assets/sky.png");
		this.load.image("ground", "assets/ground.png");
		this.load.spritesheet("player", "assets/player.png", { frameWidth: 16, frameHeight: 32 });
		this.load.spritesheet("coins", "assets/coins.png", { frameWidth: 16, frameHeight: 16 });
	}

	function create()
	{
		this.add.image(this.cameras.main.centerX, this.cameras.main.centerY, "sky").setScale(2);


		ground = this.physics.add.staticGroup();
		ground.create(config.width/2, config.height - 32, "ground").setScale(2).refreshBody();

		cursors = this.input.keyboard.createCursorKeys();

		// initialize the player
		player = this.physics.add.image(500, 100, "player");

		player.body.setGravityY(600);
		player.setVelocity(100, 200);
		player.setBounce(0.2);
		player.setCollideWorldBounds(true);
		this.physics.add.collider(player, ground);

		// initialize the coins
		coins = this.physics.add.staticGroup({
			key: "coins",
			repeat: 5
		});
		initCoins()
		this.physics.add.overlap(player, coins, collectCoin, null, this);

		// initialize score and jump
		score = 0;
		scoreText = this.add.text(16, 16, "Score: " + score, { fontSize: "32px", fill: "#000" });
		jumpLimit = 50;
		jumps = 0;
	}
	
	function update()
	{
		if (coins.countActive(true) === 0)
		{
			initCoins()
		}

		if (cursors.left.isDown)
		{
			player.setVelocityX(-160);
		}
		else if (cursors.right.isDown)
		{
			player.setVelocityX(160);
		}
		else
		{
			player.setVelocityX(0);
		}

		if (cursors.up.isDown && jumps < jumpLimit)
		{
			player.setVelocityY(-330);
			jumps += 1;
		}
		if (player.body.blocked.down)
		{
			jumps = 0;
		}
		scoreText.setText("Score: " + score + " Jumps:  " + jumps + " Total Jumps: " + jumpLimit);
	}
	</script>

</body>
</html>